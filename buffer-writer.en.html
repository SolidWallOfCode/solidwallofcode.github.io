<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>BufferWriter &#8212; AMC Traffic Server Documentation</title>
    
    <link rel="stylesheet" href="_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '8.0.x',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="TSConfig / Lua" href="tsconfig-lua.en.html" />
    <link rel="prev" title="Traffic Server Projects" href="ats-projects.en.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="tsconfig-lua.en.html" title="TSConfig / Lua"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ats-projects.en.html" title="Traffic Server Projects"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">SWOC Docs</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="ats-projects.en.html" accesskey="U">Traffic Server Projects</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/balcora-gate-400x400.jpg" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">BufferWriter</a><ul>
<li><a class="reference internal" href="#description">Description</a><ul>
<li><a class="reference internal" href="#writing">Writing</a></li>
<li><a class="reference internal" href="#reading">Reading</a></li>
<li><a class="reference internal" href="#advanced">Advanced</a></li>
</ul>
</li>
<li><a class="reference internal" href="#reference">Reference</a></li>
<li><a class="reference internal" href="#futures">Futures</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="ats-projects.en.html"
                        title="previous chapter">Traffic Server Projects</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="tsconfig-lua.en.html"
                        title="next chapter">TSConfig / Lua</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/buffer-writer.en.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="bufferwriter">
<span id="id1"></span><h1>BufferWriter<a class="headerlink" href="#bufferwriter" title="Permalink to this headline">¶</a></h1>
<p><a class="reference internal" href="#_CPPv212BufferWriter" title="BufferWriter"><code class="xref cpp cpp-class docutils literal"><span class="pre">BufferWriter</span></code></a> is a class to write text to a buffer. The design goals are to be fast and
provide buffer overrrun protection. There is a large amount of code in Traffic Server that currently uses
<code class="code docutils literal"><span class="pre">memcpy</span></code> and similar mechanisms for fast string generation. <a class="reference internal" href="#_CPPv212BufferWriter" title="BufferWriter"><code class="xref cpp cpp-class docutils literal"><span class="pre">BufferWriter</span></code></a> should be
as almost as fast while simplifying code and preventing memory corruption.</p>
<p>For example, error prone code that looks like</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="kt">char</span> <span class="n">new_via_string</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span> <span class="c1">// 512-bytes for hostname+via string, 512-bytes for the debug info</span>
<span class="kt">char</span> <span class="o">*</span> <span class="n">via_string</span> <span class="o">=</span> <span class="n">new_via_string</span><span class="p">;</span>
<span class="kt">char</span> <span class="o">*</span> <span class="n">via_limit</span>  <span class="o">=</span> <span class="n">via_string</span> <span class="o">+</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">new_via_string</span><span class="p">);</span>

<span class="c1">// ...</span>

<span class="o">*</span> <span class="n">via_string</span><span class="o">++</span> <span class="o">=</span> <span class="sc">&#39; &#39;</span><span class="p">;</span>
<span class="o">*</span> <span class="n">via_string</span><span class="o">++</span> <span class="o">=</span> <span class="sc">&#39;[&#39;</span><span class="p">;</span>

<span class="c1">// incoming_via can be max MAX_VIA_INDICES+1 long (i.e. around 25 or so)</span>
<span class="k">if</span> <span class="p">(</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">txn_conf</span><span class="o">-&gt;</span><span class="n">insert_request_via_string</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// Highest verbosity</span>
   <span class="n">via_string</span> <span class="o">+=</span> <span class="n">nstrcpy</span><span class="p">(</span><span class="n">via_string</span><span class="p">,</span> <span class="n">incoming_via</span><span class="p">);</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
   <span class="n">memcpy</span><span class="p">(</span><span class="n">via_string</span><span class="p">,</span> <span class="n">incoming_via</span> <span class="o">+</span> <span class="n">VIA_CLIENT</span><span class="p">,</span> <span class="n">VIA_SERVER</span> <span class="o">-</span> <span class="n">VIA_CLIENT</span><span class="p">);</span>
   <span class="n">via_string</span> <span class="o">+=</span> <span class="n">VIA_SERVER</span> <span class="o">-</span> <span class="n">VIA_CLIENT</span><span class="p">;</span>
<span class="p">}</span>
<span class="o">*</span><span class="n">via_string</span><span class="o">++</span> <span class="o">=</span> <span class="sc">&#39;]&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p>becomes</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="n">ts</span><span class="o">::</span><span class="n">LocalBufferWriter</span><span class="o">&lt;</span><span class="mi">1024</span><span class="o">&gt;</span> <span class="n">w</span><span class="p">;</span> <span class="c1">// 1K internal buffer.</span>

<span class="c1">// ...</span>

<span class="n">w</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; [&quot;</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">txn_conf</span><span class="o">-&gt;</span><span class="n">insert_request_via_string</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// Highest verbosity</span>
   <span class="n">w</span> <span class="o">&lt;&lt;</span> <span class="n">incoming_via</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
   <span class="n">w</span> <span class="o">&lt;&lt;</span> <span class="n">ts</span><span class="o">::</span><span class="n">string_view</span><span class="p">{</span><span class="n">incoming_via</span> <span class="o">+</span> <span class="n">VIA_CLIENT</span><span class="p">,</span> <span class="n">VIA_SERVER</span> <span class="o">-</span> <span class="n">VIA_CLIENT</span><span class="p">};</span>
<span class="p">}</span>
<span class="n">w</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;]&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p>Note that in addition there will be no overrun on the memory buffer in <em>w</em>, in strong contrast
to the original code.</p>
<div class="section" id="description">
<h2>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="#_CPPv212BufferWriter" title="BufferWriter"><code class="xref cpp cpp-class docutils literal"><span class="pre">BufferWriter</span></code></a> is an abstract super class, in the style of <code class="code docutils literal"><span class="pre">std::ostream</span></code>. There are several subclasses for various use cases.</p>
<p><a class="reference internal" href="#_CPPv217FixedBufferWriter" title="FixedBufferWriter"><code class="xref cpp cpp-class docutils literal"><span class="pre">FixedBufferWriter</span></code></a> writes to an external provided buffer of a fixed length. The buffer must
be provided to the constructor. This will generally be used in a function where the target buffer is
external to the function.</p>
<p><a class="reference internal" href="#_CPPv2I_6size_tE17LocalBufferWriter" title="LocalBufferWriter"><code class="xref cpp cpp-class docutils literal"><span class="pre">LocalBufferWriter</span></code></a> is a templated class whose template argument is the size of an internal buffer.
This is useful when the buffer is local to a function and the results will be transferred from the buffer to other storage after the output is assembled. E.g. code such as</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="kt">char</span> <span class="n">buff</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
<span class="n">ts</span><span class="o">::</span><span class="n">FixedBufferWriter</span> <span class="n">w</span><span class="p">(</span><span class="n">buff</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buff</span><span class="p">));</span>
</pre></div>
</div>
<p>is better done as</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="n">ts</span><span class="o">::</span><span class="n">LocalBufferWriter</span><span class="o">&lt;</span><span class="mi">1024</span><span class="o">&gt;</span> <span class="n">w</span><span class="p">;</span>
</pre></div>
</div>
<div class="section" id="writing">
<h3>Writing<a class="headerlink" href="#writing" title="Permalink to this headline">¶</a></h3>
<p>The basic mechanism for writing to a <a class="reference internal" href="#_CPPv212BufferWriter" title="BufferWriter"><code class="xref cpp cpp-class docutils literal"><span class="pre">BufferWriter</span></code></a> is <a class="reference internal" href="#_CPPv2N12BufferWriter5writeEPv6size_t" title="BufferWriter::write"><code class="xref cpp cpp-func docutils literal"><span class="pre">BufferWriter::write()</span></code></a>.
This is an overloaded method for a character (<code class="code docutils literal"><span class="pre">char</span></code>), a buffer (<code class="code docutils literal"><span class="pre">void</span> <span class="pre">*,</span> <span class="pre">size_t</span></code>)
and a string view (<code class="code docutils literal"><span class="pre">ts::string_view</span></code>).</p>
<p>On top of this mechanism are stream operators in the style of C++ stream I/O. The basic template
is</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="k">template</span> <span class="o">&lt;</span> <span class="k">typename</span> <span class="n">T</span> <span class="o">&gt;</span> <span class="n">ts</span><span class="o">::</span><span class="n">BufferWriter</span><span class="o">&amp;</span> <span class="k">operator</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">ts</span><span class="o">::</span><span class="n">BufferWriter</span><span class="o">&amp;</span> <span class="n">w</span><span class="p">,</span> <span class="n">T</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">t</span><span class="p">);</span>
</pre></div>
</div>
<p>Most basic types are overloaded and it is easy to extend. For instance, to make <code class="code docutils literal"><span class="pre">ts::TextView</span></code> work with <a class="reference internal" href="#_CPPv212BufferWriter" title="BufferWriter"><code class="xref cpp cpp-class docutils literal"><span class="pre">BufferWriter</span></code></a>, the code would be</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="n">ts</span><span class="o">::</span><span class="n">BufferWriter</span> <span class="o">&amp;</span> <span class="k">operator</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">ts</span><span class="o">::</span><span class="n">BufferWriter</span> <span class="o">&amp;</span> <span class="n">w</span><span class="p">,</span> <span class="n">ts</span><span class="o">::</span><span class="n">TextView</span> <span class="k">const</span> <span class="o">&amp;</span> <span class="n">sv</span><span class="p">)</span> <span class="p">{</span>
   <span class="n">w</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">sv</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span> <span class="n">sv</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
   <span class="k">return</span> <span class="n">w</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="reading">
<h3>Reading<a class="headerlink" href="#reading" title="Permalink to this headline">¶</a></h3>
<p>The data in the buffer can be extracted using <a class="reference internal" href="#_CPPv2NK12BufferWriter4dataEv" title="BufferWriter::data"><code class="xref cpp cpp-func docutils literal"><span class="pre">BufferWriter::data()</span></code></a>. This and <a class="reference internal" href="#_CPPv2NK12BufferWriter4sizeEv" title="BufferWriter::size"><code class="xref cpp cpp-func docutils literal"><span class="pre">BufferWriter::size()</span></code></a>
return a pointer to the start of the buffer and the amount of data written to the buffer. Calling <a class="reference internal" href="#_CPPv2NK12BufferWriter5errorEv" title="BufferWriter::error"><code class="xref cpp cpp-func docutils literal"><span class="pre">BufferWriter::error()</span></code></a> will indicate if more data than space available was written. <a class="reference internal" href="#_CPPv2NK12BufferWriter6extentEv" title="BufferWriter::extent"><code class="xref cpp cpp-func docutils literal"><span class="pre">BufferWriter::extent()</span></code></a> returns the amount of data written to the <a class="reference internal" href="#_CPPv212BufferWriter" title="BufferWriter"><code class="xref cpp cpp-class docutils literal"><span class="pre">BufferWriter</span></code></a>. This can be used in a two pass style with a small buffer to determine the buffer size required for the full output.</p>
</div>
<div class="section" id="advanced">
<h3>Advanced<a class="headerlink" href="#advanced" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="#_CPPv2N12BufferWriter4clipE6size_t" title="BufferWriter::clip"><code class="xref cpp cpp-func docutils literal"><span class="pre">BufferWriter::clip()</span></code></a> and <a class="reference internal" href="#_CPPv2N12BufferWriter6extendE6size_t" title="BufferWriter::extend"><code class="xref cpp cpp-func docutils literal"><span class="pre">BufferWriter::extend()</span></code></a> methods can be used to reserve space in the buffer. A common use case for this is to guarantee matching delimiters in output if buffer space is exhausted.
<a class="reference internal" href="#_CPPv2N12BufferWriter4clipE6size_t" title="BufferWriter::clip"><code class="xref cpp cpp-func docutils literal"><span class="pre">BufferWriter::clip()</span></code></a> can be used to temporarily reduce the buffer size by an amount large enough to hold
the terminal delimiter. After writing the contained output, <a class="reference internal" href="#_CPPv2N12BufferWriter6extendE6size_t" title="BufferWriter::extend"><code class="xref cpp cpp-func docutils literal"><span class="pre">BufferWriter::extend()</span></code></a> can be used to restore
the capacity and then output the terminal delimiter.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last"><strong>Never</strong> call <a class="reference internal" href="#_CPPv2N12BufferWriter6extendE6size_t" title="BufferWriter::extend"><code class="xref cpp cpp-func docutils literal"><span class="pre">BufferWriter::extend()</span></code></a> without previoiusly calling <a class="reference internal" href="#_CPPv2N12BufferWriter4clipE6size_t" title="BufferWriter::clip"><code class="xref cpp cpp-func docutils literal"><span class="pre">BufferWriter::clip()</span></code></a> and always pass the same argument value.</p>
</div>
<p><a class="reference internal" href="#_CPPv2NK12BufferWriter8capacityEv" title="BufferWriter::capacity"><code class="xref cpp cpp-func docutils literal"><span class="pre">BufferWriter::capacity()</span></code></a> returns the amount of buffer space not yet consumed.</p>
<p><a class="reference internal" href="#_CPPv2NK12BufferWriter9auxBufferEv" title="BufferWriter::auxBuffer"><code class="xref cpp cpp-func docutils literal"><span class="pre">BufferWriter::auxBuffer()</span></code></a> returns a pointer to the first byte of the buffer not yet used. This is useful to do speculative output. A new <a class="reference internal" href="#_CPPv212BufferWriter" title="BufferWriter"><code class="xref cpp cpp-class docutils literal"><span class="pre">BufferWriter</span></code></a> instance can be constructed with</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="n">ts</span><span class="o">::</span><span class="n">FixedBufferWriter</span> <span class="n">subw</span><span class="p">(</span><span class="n">w</span><span class="p">.</span><span class="n">auxBuffer</span><span class="p">(),</span> <span class="n">w</span><span class="p">.</span><span class="n">remaining</span><span class="p">());</span>
</pre></div>
</div>
<p>Output can be written to <em>subw</em>. If successful, then <code class="code docutils literal"><span class="pre">w.write(subw.size())</span></code> will add that output to the main buffer. If there is an error then <em>subw</em> can be ignored and some suitable error output written to <em>w</em> instead. A common use case is to verify there is sufficient space in the buffer and create a &#8220;not enough space&#8221; message if not. E.g.</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="n">ts</span><span class="o">::</span><span class="n">FixedBufferWriter</span> <span class="n">subw</span><span class="p">(</span><span class="n">w</span><span class="p">.</span><span class="n">auxBuffer</span><span class="p">(),</span> <span class="n">w</span><span class="p">.</span><span class="n">remaining</span><span class="p">());</span>
<span class="k">this</span><span class="o">-&gt;</span><span class="n">write_some_output</span><span class="p">(</span><span class="n">subw</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">subw</span><span class="p">.</span><span class="n">error</span><span class="p">())</span> <span class="n">w</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">subw</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
<span class="k">else</span> <span class="n">w</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Insufficient space&quot;</span><span class="n">_sv</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="reference">
<h2>Reference<a class="headerlink" href="#reference" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="_CPPv212BufferWriter">
<span id="BufferWriter"></span><em class="property">class </em><code class="descclassname"></code><code class="descname">BufferWriter</code><a class="headerlink" href="#_CPPv212BufferWriter" title="Permalink to this definition">¶</a><br /></dt>
<dd><p><a class="reference internal" href="#_CPPv212BufferWriter" title="BufferWriter"><code class="xref cpp cpp-class docutils literal"><span class="pre">BufferWriter</span></code></a> is the abstract base class which defines the basic client interface. This
is intended to be the reference type used when passing concrete instances rather than having to
support the distinct types.</p>
<dl class="function">
<dt id="_CPPv2N12BufferWriter5writeEPv6size_t">
<span id="BufferWriter::write__voidP.s"></span><a class="reference internal" href="#_CPPv212BufferWriter" title="BufferWriter">BufferWriter</a> &amp;<code class="descclassname"></code><code class="descname">write</code><span class="sig-paren">(</span>void *<em>data</em>, <a class="reference internal" href="external-types.en.html#_CPPv26size_t" title="size_t">size_t</a> <em>length</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv2N12BufferWriter5writeEPv6size_t" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Write to the buffer starting at <em>data</em> for at most <em>length</em> bytes. If there is not
enough room to fit all the data, none is written.</p>
</dd></dl>

<dl class="function">
<dt id="_CPPv2N12BufferWriter5writeEN2ts11string_viewE">
<span id="BufferWriter::write__ts::string_view"></span><a class="reference internal" href="#_CPPv212BufferWriter" title="BufferWriter">BufferWriter</a> &amp;<code class="descclassname"></code><code class="descname">write</code><span class="sig-paren">(</span><a class="reference internal" href="external-types.en.html#_CPPv22ts" title="ts">ts</a>::<a class="reference internal" href="external-types.en.html#_CPPv2N2ts11string_viewE" title="ts::string_view">string_view</a> <em>str</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv2N12BufferWriter5writeEN2ts11string_viewE" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Write the string <em>str</em> to the buffer. If there is not enough room to write the string no
data is written.</p>
</dd></dl>

<dl class="function">
<dt id="_CPPv2I_6size_tEN12BufferWriter5writeERAN_Kc">
template&lt;<a class="reference internal" href="external-types.en.html#_CPPv26size_t" title="size_t">size_t</a> <code class="descclassname"></code><code class="descname">N</code>&gt;<br /><a class="reference internal" href="#_CPPv212BufferWriter" title="BufferWriter">BufferWriter</a> &amp;<code class="descclassname"></code><code class="descname">write</code><span class="sig-paren">(</span><em class="property">const</em> char (&amp;<em>literal</em>)[N]<span class="sig-paren">)</span><a class="headerlink" href="#_CPPv2I_6size_tEN12BufferWriter5writeERAN_Kc" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Write <em>literal</em> to the output treating it as a literal string. This means the size is
computed by the compiler and the null terminator is discarded. If there is not enough space in
the buffer no data is written.</p>
</dd></dl>

<dl class="function">
<dt id="_CPPv2N12BufferWriter5writeEc">
<span id="BufferWriter::write__c"></span><a class="reference internal" href="#_CPPv212BufferWriter" title="BufferWriter">BufferWriter</a> &amp;<code class="descclassname"></code><code class="descname">write</code><span class="sig-paren">(</span>char <em>c</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv2N12BufferWriter5writeEc" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Write the character <em>c</em> to the buffer. If there is no space in the buffer the character
is not written.</p>
</dd></dl>

<dl class="function">
<dt id="_CPPv2NK12BufferWriter4dataEv">
<span id="BufferWriter::dataC"></span>char *<code class="descclassname"></code><code class="descname">data</code><span class="sig-paren">(</span><span class="sig-paren">)</span> <em class="property">const</em><a class="headerlink" href="#_CPPv2NK12BufferWriter4dataEv" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Return a pointer to start of the buffer.</p>
</dd></dl>

<dl class="function">
<dt id="_CPPv2NK12BufferWriter4sizeEv">
<span id="BufferWriter::sizeC"></span><a class="reference internal" href="external-types.en.html#_CPPv26size_t" title="size_t">size_t</a> <code class="descclassname"></code><code class="descname">size</code><span class="sig-paren">(</span><span class="sig-paren">)</span> <em class="property">const</em><a class="headerlink" href="#_CPPv2NK12BufferWriter4sizeEv" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Return the number of valid (written) bytes in the buffer.</p>
</dd></dl>

<dl class="function">
<dt id="_CPPv2NK12BufferWriter9remainingEv">
<span id="BufferWriter::remainingC"></span><a class="reference internal" href="external-types.en.html#_CPPv26size_t" title="size_t">size_t</a> <code class="descclassname"></code><code class="descname">remaining</code><span class="sig-paren">(</span><span class="sig-paren">)</span> <em class="property">const</em><a class="headerlink" href="#_CPPv2NK12BufferWriter9remainingEv" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Return the number of available remaining bytes that could be written to the buffer.</p>
</dd></dl>

<dl class="function">
<dt id="_CPPv2NK12BufferWriter8capacityEv">
<span id="BufferWriter::capacityC"></span><a class="reference internal" href="external-types.en.html#_CPPv26size_t" title="size_t">size_t</a> <code class="descclassname"></code><code class="descname">capacity</code><span class="sig-paren">(</span><span class="sig-paren">)</span> <em class="property">const</em><a class="headerlink" href="#_CPPv2NK12BufferWriter8capacityEv" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Return the number of bytes in the buffer.</p>
</dd></dl>

<dl class="function">
<dt id="_CPPv2NK12BufferWriter9auxBufferEv">
<span id="BufferWriter::auxBufferC"></span>char *<code class="descclassname"></code><code class="descname">auxBuffer</code><span class="sig-paren">(</span><span class="sig-paren">)</span> <em class="property">const</em><a class="headerlink" href="#_CPPv2NK12BufferWriter9auxBufferEv" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Return a pointer to the first byte in the buffer not yet consumed.</p>
</dd></dl>

<dl class="function">
<dt id="_CPPv2N12BufferWriter4clipE6size_t">
<span id="BufferWriter::clip__s"></span><a class="reference internal" href="#_CPPv212BufferWriter" title="BufferWriter">BufferWriter</a> &amp;<code class="descclassname"></code><code class="descname">clip</code><span class="sig-paren">(</span><a class="reference internal" href="external-types.en.html#_CPPv26size_t" title="size_t">size_t</a> <em>n</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv2N12BufferWriter4clipE6size_t" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Reduce the available space by <em>n</em> bytes.</p>
</dd></dl>

<dl class="function">
<dt id="_CPPv2N12BufferWriter6extendE6size_t">
<span id="BufferWriter::extend__s"></span><a class="reference internal" href="#_CPPv212BufferWriter" title="BufferWriter">BufferWriter</a> &amp;<code class="descclassname"></code><code class="descname">extend</code><span class="sig-paren">(</span><a class="reference internal" href="external-types.en.html#_CPPv26size_t" title="size_t">size_t</a> <em>n</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv2N12BufferWriter6extendE6size_t" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Increase the available space by <em>n</em> bytes. Extreme care must be used with this method as
<a class="reference internal" href="#_CPPv212BufferWriter" title="BufferWriter"><code class="xref cpp cpp-class docutils literal"><span class="pre">BufferWriter</span></code></a> will trust the argument, having no way to verify it. In general this
should only be used after calling <a class="reference internal" href="#_CPPv2N12BufferWriter4clipE6size_t" title="BufferWriter::clip"><code class="xref cpp cpp-func docutils literal"><span class="pre">BufferWriter::clip()</span></code></a> and passing the same value.
Together these allow the buffer to be temporarily reduced to reserve space for the trailing
element of a required pair of output strings, e.g. making sure a closing quote can be written
even if part of the string is not.</p>
</dd></dl>

<dl class="function">
<dt id="_CPPv2NK12BufferWriter5errorEv">
<span id="BufferWriter::errorC"></span>bool <code class="descclassname"></code><code class="descname">error</code><span class="sig-paren">(</span><span class="sig-paren">)</span> <em class="property">const</em><a class="headerlink" href="#_CPPv2NK12BufferWriter5errorEv" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Return <code class="code docutils literal"><span class="pre">true</span></code> if the buffer has overflowed from writing, <code class="code docutils literal"><span class="pre">false</span></code> if not.</p>
</dd></dl>

<dl class="function">
<dt id="_CPPv2NK12BufferWriter6extentEv">
<span id="BufferWriter::extentC"></span><a class="reference internal" href="external-types.en.html#_CPPv26size_t" title="size_t">size_t</a> <code class="descclassname"></code><code class="descname">extent</code><span class="sig-paren">(</span><span class="sig-paren">)</span> <em class="property">const</em><a class="headerlink" href="#_CPPv2NK12BufferWriter6extentEv" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Return the total number of bytes in all attempted writes to this buffer. This value allows a
successful retry in case of overflow, presuming the output data doesn&#8217;t change. This works
well with the standard &#8220;try before you buy&#8221; approach of attempting to write output, counting
the characters needed, then allocating a sufficiently sized buffer and actually writing.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="_CPPv217FixedBufferWriter">
<span id="FixedBufferWriter"></span><em class="property">class </em><code class="descclassname"></code><code class="descname">FixedBufferWriter</code> : <em class="property">public</em> <a class="reference internal" href="#_CPPv212BufferWriter" title="BufferWriter">BufferWriter</a><a class="headerlink" href="#_CPPv217FixedBufferWriter" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>This is a class that implements <a class="reference internal" href="#_CPPv212BufferWriter" title="BufferWriter"><code class="xref cpp cpp-class docutils literal"><span class="pre">BufferWriter</span></code></a> on a fixed buffer.</p>
<dl class="function">
<dt id="_CPPv2N17FixedBufferWriter17FixedBufferWriterEPv6size_t">
<span id="FixedBufferWriter::FixedBufferWriter__voidP.s"></span><code class="descclassname"></code><code class="descname">FixedBufferWriter</code><span class="sig-paren">(</span>void *<em>buffer</em>, <a class="reference internal" href="external-types.en.html#_CPPv26size_t" title="size_t">size_t</a> <em>length</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv2N17FixedBufferWriter17FixedBufferWriterEPv6size_t" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Construct an instance that will write to <em>buffer</em> at most <em>length</em> bytes. Individual
items are either written or not - if the item doesn&#8217;t fit nothing is written and the instance
goes in to an error state the prevents additional output. This is so that if a large item
doesn&#8217;t fit a following smaller item isn&#8217;t output out of order.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="_CPPv2I_6size_tE17LocalBufferWriter">
template&lt;<a class="reference internal" href="external-types.en.html#_CPPv26size_t" title="size_t">size_t</a> <code class="descclassname"></code><code class="descname">N</code>&gt;<br /><em class="property">class </em><code class="descclassname"></code><code class="descname">LocalBufferWriter</code> : <em class="property">public</em> <a class="reference internal" href="#_CPPv212BufferWriter" title="BufferWriter">BufferWriter</a><a class="headerlink" href="#_CPPv2I_6size_tE17LocalBufferWriter" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>This is a convenience class which is a wrapper on <a class="reference internal" href="#_CPPv217FixedBufferWriter" title="FixedBufferWriter"><code class="xref cpp cpp-class docutils literal"><span class="pre">FixedBufferWriter</span></code></a> which creates a
buffer as a member rather than having an external buffer that is passed to the instance. The
buffer is <em>N</em> bytes long. The point of this is to replace code like this:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="kt">char</span> <span class="n">buff</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
<span class="n">FixedBufferWriter</span> <span class="nf">w</span><span class="p">(</span><span class="n">buff</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buff</span><span class="p">));</span>
</pre></div>
</div>
<p>with:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="n">LocalBufferWriter</span><span class="o">&lt;</span><span class="mi">1024</span><span class="o">&gt;</span> <span class="n">w</span><span class="p">;</span>
</pre></div>
</div>
<p>Having the buffer size in only one place promotes more robust code.</p>
</dd></dl>

</div>
<div class="section" id="futures">
<h2>Futures<a class="headerlink" href="#futures" title="Permalink to this headline">¶</a></h2>
<p>A planned future extension is a variant of <a class="reference internal" href="#_CPPv212BufferWriter" title="BufferWriter"><code class="xref cpp cpp-class docutils literal"><span class="pre">BufferWriter</span></code></a> that operates on a
<code class="code docutils literal"><span class="pre">MIOBuffer</span></code>. This would be very useful in many places that work with <code class="code docutils literal"><span class="pre">MIOBuffer</span></code>
instances, most specifically in the body factory logic.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="tsconfig-lua.en.html" title="TSConfig / Lua"
             >next</a> |</li>
        <li class="right" >
          <a href="ats-projects.en.html" title="Traffic Server Projects"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">SWOC Docs</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="ats-projects.en.html" >Traffic Server Projects</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, amc@apache.org.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.5.
    </div>
  </body>
</html>