<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="867.5188px" preserveAspectRatio="none" style="width:723px;height:867px;" version="1.1" viewBox="0 0 723 867" width="723.3835px" zoomAndPan="magnify"><defs><filter height="300%" id="f18vm97z5r2wb9" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="1.3533834586466165"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="2.706766917293233" dy="2.706766917293233" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#DDFFDD" height="858.0028" style="stroke: #A80036; stroke-width: 0.6766917293233082;" width="420.2256" x="106.9173" y="2.7068"/><text fill="#000000" font-family="sans-serif" font-size="8.797" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="58.8722" x="287.594" y="10.8723">Ingress ATS</text><rect fill="#DDDDFF" height="858.0028" style="stroke: #A80036; stroke-width: 0.6766917293233082;" width="49.3985" x="579.5865" y="2.7068"/><text fill="#000000" font-family="sans-serif" font-size="8.797" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="45.3383" x="581.6165" y="10.8723">Peer ATS</text><rect fill="#FFFFFF" filter="url(#f18vm97z5r2wb9)" height="715.8817" style="stroke: #A80036; stroke-width: 0.6766917293233082;" width="6.7669" x="132.2932" y="80.3413"/><rect fill="#FFFFFF" filter="url(#f18vm97z5r2wb9)" height="617.312" style="stroke: #A80036; stroke-width: 0.6766917293233082;" width="6.7669" x="317.7068" y="178.9109"/><rect fill="#FFFFFF" filter="url(#f18vm97z5r2wb9)" height="511.9754" style="stroke: #A80036; stroke-width: 0.6766917293233082;" width="6.7669" x="503.1203" y="284.2475"/><line style="stroke: #A80036; stroke-width: 0.6766917293233082; stroke-dasharray: 5.0,5.0;" x1="42.6316" x2="42.6316" y1="59.3638" y2="802.3132"/><line style="stroke: #A80036; stroke-width: 0.6766917293233082; stroke-dasharray: 5.0,5.0;" x1="135.3383" x2="135.3383" y1="59.3638" y2="802.3132"/><line style="stroke: #A80036; stroke-width: 0.6766917293233082; stroke-dasharray: 5.0,5.0;" x1="228.0451" x2="228.0451" y1="59.3638" y2="802.3132"/><line style="stroke: #A80036; stroke-width: 0.6766917293233082; stroke-dasharray: 5.0,5.0;" x1="320.7519" x2="320.7519" y1="59.3638" y2="802.3132"/><line style="stroke: #A80036; stroke-width: 0.6766917293233082; stroke-dasharray: 5.0,5.0;" x1="413.4586" x2="413.4586" y1="59.3638" y2="802.3132"/><line style="stroke: #A80036; stroke-width: 0.6766917293233082; stroke-dasharray: 5.0,5.0;" x1="506.1654" x2="506.1654" y1="59.3638" y2="802.3132"/><line style="stroke: #A80036; stroke-width: 0.6766917293233082; stroke-dasharray: 5.0,5.0;" x1="604.2857" x2="604.2857" y1="59.3638" y2="802.3132"/><line style="stroke: #A80036; stroke-width: 0.6766917293233082; stroke-dasharray: 5.0,5.0;" x1="694.2857" x2="694.2857" y1="59.3638" y2="802.3132"/><text fill="#000000" font-family="sans-serif" font-size="9.4737" lengthAdjust="spacingAndGlyphs" textLength="27.7444" x="27.0677" y="57.1296">Client</text><ellipse cx="42.9699" cy="9.7645" fill="#FEFECE" filter="url(#f18vm97z5r2wb9)" rx="5.4135" ry="5.4135" style="stroke: #A80036; stroke-width: 1.3533834586466165;"/><path d="M42.9699,15.178 L42.9699,33.4487 M34.1729,20.5915 L51.7669,20.5915 M42.9699,33.4487 L34.1729,43.599 M42.9699,33.4487 L51.7669,43.599 " fill="#FEFECE" filter="url(#f18vm97z5r2wb9)" style="stroke: #A80036; stroke-width: 1.3533834586466165;"/><text fill="#000000" font-family="sans-serif" font-size="9.4737" lengthAdjust="spacingAndGlyphs" textLength="27.7444" x="27.0677" y="810.4302">Client</text><ellipse cx="42.9699" cy="819.4314" fill="#FEFECE" filter="url(#f18vm97z5r2wb9)" rx="5.4135" ry="5.4135" style="stroke: #A80036; stroke-width: 1.3533834586466165;"/><path d="M42.9699,824.8449 L42.9699,843.1156 M34.1729,830.2585 L51.7669,830.2585 M42.9699,843.1156 L34.1729,853.266 M42.9699,843.1156 L51.7669,853.266 " fill="#FEFECE" filter="url(#f18vm97z5r2wb9)" style="stroke: #A80036; stroke-width: 1.3533834586466165;"/><text fill="#000000" font-family="sans-serif" font-size="9.4737" lengthAdjust="spacingAndGlyphs" textLength="27.7444" x="119.7744" y="46.1016">Client</text><text fill="#000000" font-family="sans-serif" font-size="9.4737" lengthAdjust="spacingAndGlyphs" textLength="48.0451" x="109.6241" y="57.1296">NetVConn</text><ellipse cx="135.6767" cy="26.4809" fill="#FEFECE" filter="url(#f18vm97z5r2wb9)" rx="8.1203" ry="8.1203" style="stroke: #A80036; stroke-width: 1.3533834586466165;"/><line style="stroke: #A80036; stroke-width: 1.3533834586466165;" x1="127.5564" x2="143.797" y1="35.9545" y2="35.9545"/><text fill="#000000" font-family="sans-serif" font-size="9.4737" lengthAdjust="spacingAndGlyphs" textLength="27.7444" x="119.7744" y="810.4302">Client</text><text fill="#000000" font-family="sans-serif" font-size="9.4737" lengthAdjust="spacingAndGlyphs" textLength="48.0451" x="109.6241" y="821.4582">NetVConn</text><ellipse cx="135.6767" cy="834.5195" fill="#FEFECE" filter="url(#f18vm97z5r2wb9)" rx="8.1203" ry="8.1203" style="stroke: #A80036; stroke-width: 1.3533834586466165;"/><line style="stroke: #A80036; stroke-width: 1.3533834586466165;" x1="127.5564" x2="143.797" y1="843.9932" y2="843.9932"/><rect fill="#FEFECE" filter="url(#f18vm97z5r2wb9)" height="31.5296" style="stroke: #A80036; stroke-width: 1.0150375939849623;" width="43.985" x="205.0376" y="24.4508"/><text fill="#000000" font-family="sans-serif" font-size="9.4737" lengthAdjust="spacingAndGlyphs" textLength="34.5113" x="209.7744" y="37.9813">Ingress</text><text fill="#000000" font-family="sans-serif" font-size="9.4737" lengthAdjust="spacingAndGlyphs" textLength="18.9474" x="217.5564" y="49.0093">ATS</text><rect fill="#FEFECE" filter="url(#f18vm97z5r2wb9)" height="31.5296" style="stroke: #A80036; stroke-width: 1.0150375939849623;" width="43.985" x="205.0376" y="801.6365"/><text fill="#000000" font-family="sans-serif" font-size="9.4737" lengthAdjust="spacingAndGlyphs" textLength="34.5113" x="209.7744" y="815.167">Ingress</text><text fill="#000000" font-family="sans-serif" font-size="9.4737" lengthAdjust="spacingAndGlyphs" textLength="18.9474" x="217.5564" y="826.195">ATS</text><text fill="#000000" font-family="sans-serif" font-size="9.4737" lengthAdjust="spacingAndGlyphs" textLength="27.7444" x="305.188" y="46.1016">Client</text><text fill="#000000" font-family="sans-serif" font-size="9.4737" lengthAdjust="spacingAndGlyphs" textLength="31.8045" x="303.1579" y="57.1296">VConn</text><ellipse cx="321.0902" cy="26.4809" fill="#FEFECE" filter="url(#f18vm97z5r2wb9)" rx="8.1203" ry="8.1203" style="stroke: #A80036; stroke-width: 1.3533834586466165;"/><line style="stroke: #A80036; stroke-width: 1.3533834586466165;" x1="312.9699" x2="329.2105" y1="35.9545" y2="35.9545"/><text fill="#000000" font-family="sans-serif" font-size="9.4737" lengthAdjust="spacingAndGlyphs" textLength="27.7444" x="305.188" y="810.4302">Client</text><text fill="#000000" font-family="sans-serif" font-size="9.4737" lengthAdjust="spacingAndGlyphs" textLength="31.8045" x="303.1579" y="821.4582">VConn</text><ellipse cx="321.0902" cy="834.5195" fill="#FEFECE" filter="url(#f18vm97z5r2wb9)" rx="8.1203" ry="8.1203" style="stroke: #A80036; stroke-width: 1.3533834586466165;"/><line style="stroke: #A80036; stroke-width: 1.3533834586466165;" x1="312.9699" x2="329.2105" y1="843.9932" y2="843.9932"/><text fill="#000000" font-family="sans-serif" font-size="9.4737" lengthAdjust="spacingAndGlyphs" textLength="52.1053" x="385.7143" y="57.1296">TLS Bridge</text><ellipse cx="413.797" cy="37.5088" fill="#FEFECE" filter="url(#f18vm97z5r2wb9)" rx="8.1203" ry="8.1203" style="stroke: #A80036; stroke-width: 1.3533834586466165;"/><line style="stroke: #A80036; stroke-width: 1.3533834586466165;" x1="405.6767" x2="421.9173" y1="46.9825" y2="46.9825"/><text fill="#000000" font-family="sans-serif" font-size="9.4737" lengthAdjust="spacingAndGlyphs" textLength="52.1053" x="385.7143" y="810.4302">TLS Bridge</text><ellipse cx="413.797" cy="823.4915" fill="#FEFECE" filter="url(#f18vm97z5r2wb9)" rx="8.1203" ry="8.1203" style="stroke: #A80036; stroke-width: 1.3533834586466165;"/><line style="stroke: #A80036; stroke-width: 1.3533834586466165;" x1="405.6767" x2="421.9173" y1="832.9652" y2="832.9652"/><text fill="#000000" font-family="sans-serif" font-size="9.4737" lengthAdjust="spacingAndGlyphs" textLength="21.6541" x="493.6466" y="46.1016">Peer</text><text fill="#000000" font-family="sans-serif" font-size="9.4737" lengthAdjust="spacingAndGlyphs" textLength="31.8045" x="488.5714" y="57.1296">VConn</text><ellipse cx="506.5038" cy="26.4809" fill="#FEFECE" filter="url(#f18vm97z5r2wb9)" rx="8.1203" ry="8.1203" style="stroke: #A80036; stroke-width: 1.3533834586466165;"/><line style="stroke: #A80036; stroke-width: 1.3533834586466165;" x1="498.3835" x2="514.6241" y1="35.9545" y2="35.9545"/><text fill="#000000" font-family="sans-serif" font-size="9.4737" lengthAdjust="spacingAndGlyphs" textLength="21.6541" x="493.6466" y="810.4302">Peer</text><text fill="#000000" font-family="sans-serif" font-size="9.4737" lengthAdjust="spacingAndGlyphs" textLength="31.8045" x="488.5714" y="821.4582">VConn</text><ellipse cx="506.5038" cy="834.5195" fill="#FEFECE" filter="url(#f18vm97z5r2wb9)" rx="8.1203" ry="8.1203" style="stroke: #A80036; stroke-width: 1.3533834586466165;"/><line style="stroke: #A80036; stroke-width: 1.3533834586466165;" x1="498.3835" x2="514.6241" y1="843.9932" y2="843.9932"/><rect fill="#FEFECE" filter="url(#f18vm97z5r2wb9)" height="31.5296" style="stroke: #A80036; stroke-width: 1.0150375939849623;" width="31.1278" x="587.3684" y="24.4508"/><text fill="#000000" font-family="sans-serif" font-size="9.4737" lengthAdjust="spacingAndGlyphs" textLength="21.6541" x="592.1053" y="37.9813">Peer</text><text fill="#000000" font-family="sans-serif" font-size="9.4737" lengthAdjust="spacingAndGlyphs" textLength="18.9474" x="593.4586" y="49.0093">ATS</text><rect fill="#FEFECE" filter="url(#f18vm97z5r2wb9)" height="31.5296" style="stroke: #A80036; stroke-width: 1.0150375939849623;" width="31.1278" x="587.3684" y="801.6365"/><text fill="#000000" font-family="sans-serif" font-size="9.4737" lengthAdjust="spacingAndGlyphs" textLength="21.6541" x="592.1053" y="815.167">Peer</text><text fill="#000000" font-family="sans-serif" font-size="9.4737" lengthAdjust="spacingAndGlyphs" textLength="18.9474" x="593.4586" y="826.195">ATS</text><rect fill="#FEFECE" filter="url(#f18vm97z5r2wb9)" height="20.5016" style="stroke: #A80036; stroke-width: 1.0150375939849623;" width="45.3383" x="670.6015" y="35.4787"/><text fill="#000000" font-family="sans-serif" font-size="9.4737" lengthAdjust="spacingAndGlyphs" textLength="35.8647" x="675.3383" y="49.0093">Service</text><rect fill="#FEFECE" filter="url(#f18vm97z5r2wb9)" height="20.5016" style="stroke: #A80036; stroke-width: 1.0150375939849623;" width="45.3383" x="670.6015" y="801.6365"/><text fill="#000000" font-family="sans-serif" font-size="9.4737" lengthAdjust="spacingAndGlyphs" textLength="35.8647" x="675.3383" y="815.167">Service</text><rect fill="#FFFFFF" filter="url(#f18vm97z5r2wb9)" height="715.8817" style="stroke: #A80036; stroke-width: 0.6766917293233082;" width="6.7669" x="132.2932" y="80.3413"/><rect fill="#FFFFFF" filter="url(#f18vm97z5r2wb9)" height="617.312" style="stroke: #A80036; stroke-width: 0.6766917293233082;" width="6.7669" x="317.7068" y="178.9109"/><rect fill="#FFFFFF" filter="url(#f18vm97z5r2wb9)" height="511.9754" style="stroke: #A80036; stroke-width: 0.6766917293233082;" width="6.7669" x="503.1203" y="284.2475"/><polygon fill="#008000" points="50.4135,77.6345,43.6466,80.3413,50.4135,83.048,47.7068,80.3413" style="stroke: #008000; stroke-width: 0.6766917293233082;"/><polygon fill="#008000" points="220.2632,77.6345,227.0301,80.3413,220.2632,83.048,222.9699,80.3413" style="stroke: #008000; stroke-width: 0.6766917293233082;"/><line style="stroke: #008000; stroke-width: 0.6766917293233082;" x1="46.3534" x2="224.3233" y1="80.3413" y2="80.3413"/><text fill="#008000" font-family="sans-serif" font-size="8.797" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="16.9173" x="54.4737" y="77.0031">TCP</text><text fill="#000000" font-family="sans-serif" font-size="8.797" lengthAdjust="spacingAndGlyphs" textLength="49.3985" x="74.0977" y="77.0031">Handshake</text><polygon fill="#0000FF" points="124.1729,97.3484,130.9398,100.0552,124.1729,102.762,126.8797,100.0552" style="stroke: #0000FF; stroke-width: 0.6766917293233082;"/><line style="stroke: #0000FF; stroke-width: 0.6766917293233082; stroke-dasharray: 2.0,2.0;" x1="42.9699" x2="128.2331" y1="100.0552" y2="100.0552"/><text fill="#0000FF" font-family="monospace" font-size="8.797" lengthAdjust="spacingAndGlyphs" textLength="37.8947" x="47.7068" y="96.717">CONNECT</text><text fill="#0000FF" font-family="sans-serif" font-size="8.797" lengthAdjust="spacingAndGlyphs" textLength="32.4812" x="88.3083" y="96.717">Service</text><polygon fill="#A80036" points="220.2632,117.0624,227.0301,119.7691,220.2632,122.4759,222.9699,119.7691" style="stroke: #A80036; stroke-width: 0.6766917293233082;"/><line style="stroke: #A80036; stroke-width: 0.6766917293233082;" x1="139.0602" x2="224.3233" y1="119.7691" y2="119.7691"/><text fill="#000000" font-family="sans-serif" font-size="8.797" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="60.2256" x="143.797" y="116.431">Parse request</text><polygon fill="#000000" points="405.6767,136.7763,412.4436,139.4831,405.6767,142.1898,408.3835,139.4831" style="stroke: #000000; stroke-width: 0.6766917293233082;"/><line style="stroke: #000000; stroke-width: 0.6766917293233082;" x1="228.3835" x2="409.7368" y1="139.4831" y2="139.4831"/><text fill="#000000" font-family="monospace" font-size="8.797" lengthAdjust="spacingAndGlyphs" textLength="113.6842" x="233.1203" y="136.1449">READ_REQUEST_HDR_HOOK</text><polygon fill="#A80036" points="235.8271,156.4902,229.0602,159.197,235.8271,161.9038,233.1203,159.197" style="stroke: #A80036; stroke-width: 0.6766917293233082;"/><line style="stroke: #A80036; stroke-width: 0.6766917293233082;" x1="231.7669" x2="413.1203" y1="159.197" y2="159.197"/><text fill="#000000" font-family="sans-serif" font-size="8.797" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="92.0301" x="239.8872" y="155.8588">TSHttpTxnIntercept()</text><polygon fill="#A80036" points="309.5865,176.2042,316.3534,178.9109,309.5865,181.6177,312.2932,178.9109" style="stroke: #A80036; stroke-width: 0.6766917293233082;"/><line style="stroke: #A80036; stroke-width: 0.6766917293233082;" x1="228.3835" x2="313.6466" y1="178.9109" y2="178.9109"/><text fill="#000000" font-family="sans-serif" font-size="8.797" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="29.0977" x="233.1203" y="175.5728">Create</text><polygon fill="#0000FF" points="220.2632,195.9181,227.0301,198.6249,220.2632,201.3316,222.9699,198.6249" style="stroke: #0000FF; stroke-width: 0.6766917293233082;"/><line style="stroke: #0000FF; stroke-width: 0.6766917293233082; stroke-dasharray: 2.0,2.0;" x1="139.0602" x2="224.3233" y1="198.6249" y2="198.6249"/><text fill="#0000FF" font-family="monospace" font-size="8.797" lengthAdjust="spacingAndGlyphs" textLength="37.8947" x="143.797" y="195.2867">CONNECT</text><text fill="#0000FF" font-family="sans-serif" font-size="8.797" lengthAdjust="spacingAndGlyphs" textLength="32.4812" x="184.3985" y="195.2867">Service</text><polygon fill="#0000FF" points="309.5865,215.632,316.3534,218.3388,309.5865,221.0456,312.2932,218.3388" style="stroke: #0000FF; stroke-width: 0.6766917293233082;"/><line style="stroke: #0000FF; stroke-width: 0.6766917293233082; stroke-dasharray: 2.0,2.0;" x1="228.3835" x2="313.6466" y1="218.3388" y2="218.3388"/><text fill="#0000FF" font-family="monospace" font-size="8.797" lengthAdjust="spacingAndGlyphs" textLength="37.8947" x="233.1203" y="215.0006">CONNECT</text><text fill="#0000FF" font-family="sans-serif" font-size="8.797" lengthAdjust="spacingAndGlyphs" textLength="32.4812" x="273.7218" y="215.0006">Service</text><polygon fill="#000000" points="405.6767,238.7294,412.4436,241.4362,405.6767,244.143,408.3835,241.4362" style="stroke: #000000; stroke-width: 0.6766917293233082;"/><line style="stroke: #000000; stroke-width: 0.6766917293233082;" x1="228.3835" x2="409.7368" y1="241.4362" y2="241.4362"/><text fill="#000000" font-family="monospace" font-size="8.797" lengthAdjust="spacingAndGlyphs" textLength="102.8571" x="233.1203" y="238.098">TS_EVENT_NET_ACCEPT</text><polygon fill="#FBFB77" filter="url(#f18vm97z5r2wb9)" points="416.8421,227.2257,416.8421,244.143,595.4887,244.143,595.4887,233.9926,588.7218,227.2257,416.8421,227.2257" style="stroke: #A80036; stroke-width: 0.6766917293233082;"/><line style="stroke: #A80036; stroke-width: 0.6766917293233082;" x1="588.7218" x2="588.7218" y1="227.2257" y2="233.9926"/><line style="stroke: #A80036; stroke-width: 0.6766917293233082;" x1="595.4887" x2="588.7218" y1="233.9926" y2="233.9926"/><text fill="#000000" font-family="sans-serif" font-size="8.797" lengthAdjust="spacingAndGlyphs" textLength="164.4361" x="420.9023" y="238.7747">Client VConn is passed in event data.</text><polygon fill="#A80036" points="235.8271,261.8268,229.0602,264.5336,235.8271,264.5336" style="stroke: #A80036; stroke-width: 0.6766917293233082;"/><line style="stroke: #A80036; stroke-width: 0.6766917293233082;" x1="228.3835" x2="413.1203" y1="264.5336" y2="264.5336"/><text fill="#000000" font-family="sans-serif" font-size="8.797" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="72.406" x="239.8872" y="261.1954">TSHttpConnect()</text><polygon fill="#A80036" points="495,281.5408,501.7669,284.2475,495,286.9543,497.7068,284.2475" style="stroke: #A80036; stroke-width: 0.6766917293233082;"/><line style="stroke: #A80036; stroke-width: 0.6766917293233082;" x1="228.3835" x2="499.0602" y1="284.2475" y2="284.2475"/><text fill="#000000" font-family="sans-serif" font-size="8.797" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="27.7444" x="233.1203" y="280.9093">create</text><polygon fill="#A80036" points="405.6767,304.6382,412.4436,304.6382,405.6767,307.3449" style="stroke: #A80036; stroke-width: 0.6766917293233082;"/><line style="stroke: #A80036; stroke-width: 0.6766917293233082;" x1="228.3835" x2="413.1203" y1="303.9615" y2="303.9615"/><text fill="#000000" font-family="sans-serif" font-size="8.797" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="79.8496" x="233.1203" y="300.6233">return Peer VConn</text><polygon fill="#0000FF" points="495,320.9686,501.7669,323.6754,495,326.3822,497.7068,323.6754" style="stroke: #0000FF; stroke-width: 0.6766917293233082;"/><line style="stroke: #0000FF; stroke-width: 0.6766917293233082; stroke-dasharray: 2.0,2.0;" x1="413.797" x2="499.0602" y1="323.6754" y2="323.6754"/><text fill="#0000FF" font-family="monospace" font-size="8.797" lengthAdjust="spacingAndGlyphs" textLength="37.8947" x="418.5338" y="320.3372">CONNECT</text><text fill="#0000FF" font-family="sans-serif" font-size="8.797" lengthAdjust="spacingAndGlyphs" textLength="19.6241" x="459.1353" y="320.3372">Peer</text><polygon fill="#A80036" points="235.8271,340.6826,229.0602,343.3893,235.8271,346.0961,233.1203,343.3893" style="stroke: #A80036; stroke-width: 0.6766917293233082;"/><line style="stroke: #A80036; stroke-width: 0.6766917293233082;" x1="231.7669" x2="502.4436" y1="343.3893" y2="343.3893"/><text fill="#000000" font-family="sans-serif" font-size="8.797" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="60.2256" x="239.8872" y="340.0511">parse request</text><polygon fill="#008000" points="235.8271,360.3965,229.0602,363.1033,235.8271,365.81,233.1203,363.1033" style="stroke: #008000; stroke-width: 0.6766917293233082;"/><polygon fill="#008000" points="596.1654,360.3965,602.9323,363.1033,596.1654,365.81,598.8722,363.1033" style="stroke: #008000; stroke-width: 0.6766917293233082;"/><line style="stroke: #008000; stroke-width: 0.6766917293233082;" x1="231.7669" x2="600.2256" y1="363.1033" y2="363.1033"/><text fill="#008000" font-family="sans-serif" font-size="8.797" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="16.9173" x="239.8872" y="359.7651">TCP</text><text fill="#000000" font-family="sans-serif" font-size="8.797" lengthAdjust="spacingAndGlyphs" textLength="49.3985" x="259.5113" y="359.7651">Handshake</text><polygon fill="#008000" points="235.8271,380.1104,229.0602,382.8172,235.8271,385.524,233.1203,382.8172" style="stroke: #008000; stroke-width: 0.6766917293233082;"/><polygon fill="#008000" points="596.1654,380.1104,602.9323,382.8172,596.1654,385.524,598.8722,382.8172" style="stroke: #008000; stroke-width: 0.6766917293233082;"/><line style="stroke: #008000; stroke-width: 0.6766917293233082;" x1="231.7669" x2="600.2256" y1="382.8172" y2="382.8172"/><text fill="#008000" font-family="sans-serif" font-size="8.797" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="15.5639" x="239.8872" y="379.479">TLS</text><text fill="#000000" font-family="sans-serif" font-size="8.797" lengthAdjust="spacingAndGlyphs" textLength="49.3985" x="258.1579" y="379.479">Handshake</text><polygon fill="#0000FF" points="495,399.8244,501.7669,402.5311,495,405.2379,497.7068,402.5311" style="stroke: #0000FF; stroke-width: 0.6766917293233082;"/><line style="stroke: #0000FF; stroke-width: 0.6766917293233082; stroke-dasharray: 2.0,2.0;" x1="228.3835" x2="499.0602" y1="402.5311" y2="402.5311"/><text fill="#0000FF" font-family="monospace" font-size="8.797" lengthAdjust="spacingAndGlyphs" textLength="32.4812" x="233.1203" y="399.1929">200 OK</text><polygon fill="#0000FF" points="421.2406,433.162,414.4737,435.8688,421.2406,438.5755,418.5338,435.8688" style="stroke: #0000FF; stroke-width: 0.6766917293233082;"/><line style="stroke: #0000FF; stroke-width: 0.6766917293233082; stroke-dasharray: 2.0,2.0;" x1="417.1805" x2="502.4436" y1="435.8688" y2="435.8688"/><text fill="#0000FF" font-family="monospace" font-size="8.797" lengthAdjust="spacingAndGlyphs" textLength="32.4812" x="425.3008" y="432.5306">200 OK</text><polygon fill="#FBFB77" filter="url(#f18vm97z5r2wb9)" points="244.9624,411.418,244.9624,448.636,407.3684,448.636,407.3684,418.1849,400.6015,411.418,244.9624,411.418" style="stroke: #A80036; stroke-width: 0.6766917293233082;"/><line style="stroke: #A80036; stroke-width: 0.6766917293233082;" x1="400.6015" x2="400.6015" y1="411.418" y2="418.1849"/><line style="stroke: #A80036; stroke-width: 0.6766917293233082;" x1="407.3684" x2="400.6015" y1="418.1849" y2="418.1849"/><text fill="#000000" font-family="sans-serif" font-size="8.797" lengthAdjust="spacingAndGlyphs" textLength="148.1955" x="249.0226" y="422.967">This signals a raw TLS connection</text><text fill="#000000" font-family="sans-serif" font-size="8.797" lengthAdjust="spacingAndGlyphs" textLength="147.5188" x="249.0226" y="433.2073">nto the Peer ATS. The response is</text><text fill="#000000" font-family="sans-serif" font-size="8.797" lengthAdjust="spacingAndGlyphs" textLength="142.782" x="249.0226" y="443.4475">parsed and consumed by Plugin.</text><polygon fill="#FBFB77" filter="url(#f18vm97z5r2wb9)" points="327.5188,458.3793,327.5188,475.2966,496.6917,475.2966,496.6917,465.1463,489.9248,458.3793,327.5188,458.3793" style="stroke: #A80036; stroke-width: 0.6766917293233082;"/><line style="stroke: #A80036; stroke-width: 0.6766917293233082;" x1="489.9248" x2="489.9248" y1="458.3793" y2="465.1463"/><line style="stroke: #A80036; stroke-width: 0.6766917293233082;" x1="496.6917" x2="489.9248" y1="465.1463" y2="465.1463"/><text fill="#000000" font-family="sans-serif" font-size="8.797" lengthAdjust="spacingAndGlyphs" textLength="154.9624" x="331.5789" y="469.9284">Plugin switches to byte forwarding.</text><polygon fill="#0000FF" points="405.6767,496.364,412.4436,499.0707,405.6767,501.7775,408.3835,499.0707" style="stroke: #0000FF; stroke-width: 0.6766917293233082;"/><line style="stroke: #0000FF; stroke-width: 0.6766917293233082; stroke-dasharray: 2.0,2.0;" x1="324.4737" x2="409.7368" y1="499.0707" y2="499.0707"/><text fill="#0000FF" font-family="monospace" font-size="8.797" lengthAdjust="spacingAndGlyphs" textLength="37.8947" x="329.2105" y="495.7325">CONNECT</text><text fill="#0000FF" font-family="sans-serif" font-size="8.797" lengthAdjust="spacingAndGlyphs" textLength="32.4812" x="369.812" y="495.7325">Service</text><polygon fill="#FBFB77" filter="url(#f18vm97z5r2wb9)" points="192.8571,484.8602,192.8571,501.7775,311.2782,501.7775,311.2782,491.6271,304.5113,484.8602,192.8571,484.8602" style="stroke: #A80036; stroke-width: 0.6766917293233082;"/><line style="stroke: #A80036; stroke-width: 0.6766917293233082;" x1="304.5113" x2="304.5113" y1="484.8602" y2="491.6271"/><line style="stroke: #A80036; stroke-width: 0.6766917293233082;" x1="311.2782" x2="304.5113" y1="491.6271" y2="491.6271"/><text fill="#000000" font-family="sans-serif" font-size="8.797" lengthAdjust="spacingAndGlyphs" textLength="104.2105" x="196.9173" y="496.4092">Original Client Request.</text><polygon fill="#0000FF" points="495,519.4613,501.7669,522.1681,495,524.8749,497.7068,522.1681" style="stroke: #0000FF; stroke-width: 0.6766917293233082;"/><line style="stroke: #0000FF; stroke-width: 0.6766917293233082; stroke-dasharray: 2.0,2.0;" x1="413.797" x2="499.0602" y1="522.1681" y2="522.1681"/><text fill="#0000FF" font-family="monospace" font-size="8.797" lengthAdjust="spacingAndGlyphs" textLength="37.8947" x="418.5338" y="518.8299">CONNECT</text><text fill="#0000FF" font-family="sans-serif" font-size="8.797" lengthAdjust="spacingAndGlyphs" textLength="32.4812" x="459.1353" y="518.8299">Service</text><polygon fill="#0000FF" points="596.1654,539.1753,602.9323,541.882,596.1654,544.5888,598.8722,541.882" style="stroke: #0000FF; stroke-width: 0.6766917293233082;"/><line style="stroke: #0000FF; stroke-width: 0.6766917293233082; stroke-dasharray: 2.0,2.0;" x1="509.8872" x2="600.2256" y1="541.882" y2="541.882"/><text fill="#0000FF" font-family="monospace" font-size="8.797" lengthAdjust="spacingAndGlyphs" textLength="37.8947" x="514.6241" y="538.5439">CONNECT</text><text fill="#0000FF" font-family="sans-serif" font-size="8.797" lengthAdjust="spacingAndGlyphs" textLength="32.4812" x="555.2256" y="538.5439">Service</text><polygon fill="#008000" points="611.7293,558.8892,604.9624,561.596,611.7293,564.3027,609.0226,561.596" style="stroke: #008000; stroke-width: 0.6766917293233082;"/><polygon fill="#008000" points="686.5038,558.8892,693.2707,561.596,686.5038,564.3027,689.2105,561.596" style="stroke: #008000; stroke-width: 0.6766917293233082;"/><line style="stroke: #008000; stroke-width: 0.6766917293233082;" x1="607.6692" x2="690.5639" y1="561.596" y2="561.596"/><text fill="#008000" font-family="sans-serif" font-size="8.797" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="16.9173" x="615.7895" y="558.2578">TCP</text><text fill="#000000" font-family="sans-serif" font-size="8.797" lengthAdjust="spacingAndGlyphs" textLength="49.3985" x="635.4135" y="558.2578">Handshake</text><polygon fill="#008000" points="611.7293,581.9866,604.9624,584.6934,611.7293,587.4001,609.0226,584.6934" style="stroke: #008000; stroke-width: 0.6766917293233082;"/><polygon fill="#008000" points="686.5038,581.9866,693.2707,584.6934,686.5038,587.4001,689.2105,584.6934" style="stroke: #008000; stroke-width: 0.6766917293233082;"/><line style="stroke: #008000; stroke-width: 0.6766917293233082;" x1="607.6692" x2="690.5639" y1="584.6934" y2="584.6934"/><text fill="#008000" font-family="sans-serif" font-size="8.797" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="15.5639" x="615.7895" y="581.3552">TLS</text><text fill="#000000" font-family="sans-serif" font-size="8.797" lengthAdjust="spacingAndGlyphs" textLength="49.3985" x="634.0602" y="581.3552">Handshake</text><polygon fill="#FBFB77" filter="url(#f18vm97z5r2wb9)" points="460.8271,570.4828,460.8271,587.4001,598.1955,587.4001,598.1955,577.2498,591.4286,570.4828,460.8271,570.4828" style="stroke: #A80036; stroke-width: 0.6766917293233082;"/><line style="stroke: #A80036; stroke-width: 0.6766917293233082;" x1="591.4286" x2="591.4286" y1="570.4828" y2="577.2498"/><line style="stroke: #A80036; stroke-width: 0.6766917293233082;" x1="598.1955" x2="591.4286" y1="577.2498" y2="577.2498"/><text fill="#000000" font-family="sans-serif" font-size="8.797" lengthAdjust="spacingAndGlyphs" textLength="123.1579" x="464.8872" y="582.0319">Optional, based on 'Service'</text><polygon fill="#0000FF" points="517.3308,605.084,510.5639,607.7908,517.3308,610.4975,514.6241,607.7908" style="stroke: #0000FF; stroke-width: 0.6766917293233082;"/><line style="stroke: #0000FF; stroke-width: 0.6766917293233082; stroke-dasharray: 2.0,2.0;" x1="513.2707" x2="603.609" y1="607.7908" y2="607.7908"/><text fill="#0000FF" font-family="monospace" font-size="8.797" lengthAdjust="spacingAndGlyphs" textLength="32.4812" x="521.391" y="604.4526">200 OK</text><polygon fill="#0000FF" points="421.2406,624.7979,414.4737,627.5047,421.2406,630.2115,418.5338,627.5047" style="stroke: #0000FF; stroke-width: 0.6766917293233082;"/><line style="stroke: #0000FF; stroke-width: 0.6766917293233082; stroke-dasharray: 2.0,2.0;" x1="417.1805" x2="502.4436" y1="627.5047" y2="627.5047"/><text fill="#0000FF" font-family="monospace" font-size="8.797" lengthAdjust="spacingAndGlyphs" textLength="32.4812" x="425.3008" y="624.1665">200 OK</text><polygon fill="#0000FF" points="331.9173,644.5119,325.1504,647.2186,331.9173,649.9254,329.2105,647.2186" style="stroke: #0000FF; stroke-width: 0.6766917293233082;"/><line style="stroke: #0000FF; stroke-width: 0.6766917293233082; stroke-dasharray: 2.0,2.0;" x1="327.8571" x2="413.1203" y1="647.2186" y2="647.2186"/><text fill="#0000FF" font-family="monospace" font-size="8.797" lengthAdjust="spacingAndGlyphs" textLength="32.4812" x="335.9774" y="643.8804">200 OK</text><polygon fill="#0000FF" points="235.8271,682.9696,229.0602,685.6764,235.8271,688.3832,233.1203,685.6764" style="stroke: #0000FF; stroke-width: 0.6766917293233082;"/><line style="stroke: #0000FF; stroke-width: 0.6766917293233082; stroke-dasharray: 2.0,2.0;" x1="231.7669" x2="317.0301" y1="685.6764" y2="685.6764"/><text fill="#0000FF" font-family="monospace" font-size="8.797" lengthAdjust="spacingAndGlyphs" textLength="32.4812" x="239.8872" y="682.3382">200 OK</text><polygon fill="#FBFB77" filter="url(#f18vm97z5r2wb9)" points="5.4135,656.1055,5.4135,703.4739,222.6316,703.4739,222.6316,662.8724,215.8647,656.1055,5.4135,656.1055" style="stroke: #A80036; stroke-width: 0.6766917293233082;"/><line style="stroke: #A80036; stroke-width: 0.6766917293233082;" x1="215.8647" x2="215.8647" y1="656.1055" y2="662.8724"/><line style="stroke: #A80036; stroke-width: 0.6766917293233082;" x1="222.6316" x2="215.8647" y1="662.8724" y2="662.8724"/><text fill="#000000" font-family="sans-serif" font-size="8.797" lengthAdjust="spacingAndGlyphs" textLength="200.3008" x="9.4737" y="667.6545">ATS updates the incoming response based on</text><text fill="#000000" font-family="sans-serif" font-size="8.797" lengthAdjust="spacingAndGlyphs" textLength="203.0075" x="9.4737" y="677.8948">local configuration. This means what goes out</text><text fill="#000000" font-family="sans-serif" font-size="8.797" lengthAdjust="spacingAndGlyphs" textLength="194.2105" x="9.4737" y="688.135">to the Client may be different than what the</text><text fill="#000000" font-family="sans-serif" font-size="8.797" lengthAdjust="spacingAndGlyphs" textLength="177.2932" x="9.4737" y="698.3753">plugin wrote (forwarded from Peer ATS).</text><polygon fill="#000000" points="405.6767,724.8109,412.4436,727.5176,405.6767,730.2244,408.3835,727.5176" style="stroke: #000000; stroke-width: 0.6766917293233082;"/><line style="stroke: #000000; stroke-width: 0.6766917293233082;" x1="228.3835" x2="409.7368" y1="727.5176" y2="727.5176"/><text fill="#000000" font-family="monospace" font-size="8.797" lengthAdjust="spacingAndGlyphs" textLength="119.0977" x="233.1203" y="724.1794">SEND_RESPONSE_HDR_HOOK</text><polygon fill="#FBFB77" filter="url(#f18vm97z5r2wb9)" points="416.8421,713.3071,416.8421,730.2244,570.4511,730.2244,570.4511,720.074,563.6842,713.3071,416.8421,713.3071" style="stroke: #A80036; stroke-width: 0.6766917293233082;"/><line style="stroke: #A80036; stroke-width: 0.6766917293233082;" x1="563.6842" x2="563.6842" y1="713.3071" y2="720.074"/><line style="stroke: #A80036; stroke-width: 0.6766917293233082;" x1="570.4511" x2="563.6842" y1="720.074" y2="720.074"/><text fill="#000000" font-family="sans-serif" font-size="8.797" lengthAdjust="spacingAndGlyphs" textLength="139.3985" x="420.9023" y="724.8561">Plugin cleans up response here.</text><polygon fill="#0000FF" points="146.5038,747.9082,139.7368,750.615,146.5038,753.3218,143.797,750.615" style="stroke: #0000FF; stroke-width: 0.6766917293233082;"/><line style="stroke: #0000FF; stroke-width: 0.6766917293233082; stroke-dasharray: 2.0,2.0;" x1="142.4436" x2="227.7068" y1="750.615" y2="750.615"/><text fill="#0000FF" font-family="monospace" font-size="8.797" lengthAdjust="spacingAndGlyphs" textLength="32.4812" x="150.5639" y="747.2768">200 OK</text><polygon fill="#0000FF" points="50.4135,767.6222,43.6466,770.3289,50.4135,773.0357,47.7068,770.3289" style="stroke: #0000FF; stroke-width: 0.6766917293233082;"/><line style="stroke: #0000FF; stroke-width: 0.6766917293233082; stroke-dasharray: 2.0,2.0;" x1="46.3534" x2="131.6165" y1="770.3289" y2="770.3289"/><text fill="#0000FF" font-family="monospace" font-size="8.797" lengthAdjust="spacingAndGlyphs" textLength="32.4812" x="54.4737" y="766.9908">200 OK</text><polygon fill="#008000" points="50.4135,787.3361,43.6466,790.0429,50.4135,792.7496,47.7068,790.0429" style="stroke: #008000; stroke-width: 0.6766917293233082;"/><polygon fill="#008000" points="686.5038,787.3361,693.2707,790.0429,686.5038,792.7496,689.2105,790.0429" style="stroke: #008000; stroke-width: 0.6766917293233082;"/><line style="stroke: #008000; stroke-width: 0.6766917293233082;" x1="46.3534" x2="690.5639" y1="790.0429" y2="790.0429"/><text fill="#000000" font-family="sans-serif" font-size="8.797" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="73.7594" x="54.4737" y="786.7047">TCP/TLS Connect</text><!--
@startuml

scale max 720 width

actor Client
box "Ingress ATS" #DDFFDD
entity "Client\nNetVConn" as uanet
participant "Ingress\nATS" as ingress
entity "Client\nVConn" as uavc
entity "TLS Bridge" as plugin
entity "Peer\nVConn" as peervc
end box
box "Peer ATS" #DDDDFF
participant "Peer\nATS" as peer
end box
participant Service

Client <-[#green]> ingress : <font color="green">//TCP//</font> Handshake
activate uanet
Client -[#blue]-> uanet : <font color="blue">""CONNECT"" Service</font>
uanet -> ingress : //Parse request//
ingress -[#black]> plugin : ""READ_REQUEST_HDR_HOOK""
plugin -> ingress : //TSHttpTxnIntercept()//
ingress -> uavc : //Create//
activate uavc
uanet -[#blue]-> ingress : <font color="blue">""CONNECT"" Service</font>
ingress -[#blue]-> uavc : <font color="blue">""CONNECT"" Service</font>
ingress -[#black]> plugin : ""TS_EVENT_NET_ACCEPT""
note right : Client VConn is passed in event data.

plugin -\ ingress : //TSHttpConnect()//
ingress -> peervc : //create//
activate peervc
ingress -/ plugin : //return Peer VConn//

plugin -[#blue]-> peervc : <font color="blue">""CONNECT"" Peer</font>
peervc -> ingress : //parse request//
ingress <-[#green]> peer : <font color="green">//TCP//</font> Handshake
ingress <-[#green]> peer : <font color="green">//TLS//</font> Handshake
ingress -[#blue]-> peervc : <font color="blue">""200 OK""</font>
peervc -[#blue]-> plugin : <font color="blue">""200 OK""</font>
note left
This signals a raw TLS connection
nto the Peer ATS. The response is
parsed and consumed by Plugin.
end note

note over plugin : Plugin switches to byte forwarding.
uavc -[#blue]-> plugin : <font color="blue">""CONNECT"" Service</font>
note left: Original Client Request.
plugin -[#blue]-> peervc : <font color="blue">""CONNECT"" Service</font>
peervc -[#blue]-> peer : <font color="blue">""CONNECT"" Service</font>
peer <-[#green]> Service : <font color="green">//TCP//</font> Handshake
peer <-[#green]> Service : <font color="green">//TLS//</font> Handshake
note left : Optional, based on 'Service'
peer -[#blue]-> peervc : <font color="blue">""200 OK""</font>
peervc -[#blue]-> plugin : <font color="blue">""200 OK""</font>
plugin -[#blue]-> uavc : <font color="blue">""200 OK""</font>
uavc -[#blue]-> ingress : <font color="blue">""200 OK""</font>
note left
ATS updates the incoming response based on
local configuration. This means what goes out
to the Client may be different than what the
plugin wrote (forwarded from Peer ATS).
end note
ingress -[#black]> plugin : ""SEND_RESPONSE_HDR_HOOK""
note right : Plugin cleans up response here.
ingress -[#blue]-> uanet : <font color="blue">""200 OK""</font>
uanet -[#blue]-> Client : <font color="blue">""200 OK""</font>

Client <-[#green]> Service : //TCP/TLS Connect//

@enduml

PlantUML version 1.2017.18(Fri Oct 06 11:56:32 CDT 2017)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_151-b12
Operating System: Linux
OS Version: 4.13.13-200.fc26.x86_64
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>