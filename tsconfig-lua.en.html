
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>TSConfig / Lua &#8212; AMC Traffic Server Documentation</title>
    <link rel="stylesheet" href="_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '8.0.x',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Cache Tool" href="cache-tool.en.html" />
    <link rel="prev" title="Buffer Writer" href="buffer-writer.en.html" /> 
  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="cache-tool.en.html" title="Cache Tool"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="buffer-writer.en.html" title="Buffer Writer"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">SWOC Docs</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="ats-projects.en.html" accesskey="U">Traffic Server Projects</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/balcora-gate-400x400.jpg" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">TSConfig / Lua</a><ul>
<li><a class="reference internal" href="#current-practice">Current Practice</a></li>
<li><a class="reference internal" href="#design">Design</a></li>
<li><a class="reference internal" href="#implementation">Implementation</a></li>
<li><a class="reference internal" href="#interface">Interface</a></li>
<li><a class="reference internal" href="#future-work">Future Work</a></li>
<li><a class="reference internal" href="#schema">Schema</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="buffer-writer.en.html"
                        title="previous chapter">Buffer Writer</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="cache-tool.en.html"
                        title="next chapter">Cache Tool</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/tsconfig-lua.en.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="tsconfig-lua">
<span id="id1"></span><h1>TSConfig / Lua<a class="headerlink" href="#tsconfig-lua" title="Permalink to this headline">¶</a></h1>
<p>Traffic Server has committed to moving configuration files to be LUA based. While conversion of existing files
to LUA isn’t required, the current view based on mailing list discussions is that new configuration
files are required to be in LUA. This project is about providing that technology in a generic way to
make it easier to add configuration for new features.</p>
<div class="section" id="current-practice">
<h2>Current Practice<a class="headerlink" href="#current-practice" title="Permalink to this headline">¶</a></h2>
<p>The primary example current is the custom logging configuration file <code class="file docutils literal"><span class="pre">logging.config</span></code> which is
processed as a LUA file. The interface to the Traffic Server core is done by creating LUA types in the core
and exposing them to the LUA interpretor (see <a class="reference external" href="https://github.com/apache/trafficserver/blob/master/proxy/logging/LogBindings.cc">LogBindings.cc</a>). Data is
transfered by the LUA interpretor parsing calls to the extended LUA types and then invoking the core
provided instances with arguments passed by the interpretor, which are then stored in logging
configuration data structures. This works but with the downside that every subsystem that needs a
configuration file will need to write specialized LUA types to get its data.</p>
</div>
<div class="section" id="design">
<h2>Design<a class="headerlink" href="#design" title="Permalink to this headline">¶</a></h2>
<p>An alternative is to provide a more generic facility that has the LUA file construct a forest of
data and then copy that forest over to a C++ container. There is already an existing library of this
type, TSConfig. TSConfig had its own input file format based on <a class="reference external" href="https://github.com/hyperrealm/libconfig">libconfig</a> plus a C++ tree container interface supporting a small
set of basic types. This interface suffices for the require LUA config interface. The approach here
is to keep the TSConfig C++ data access interface and replace the configuration file parsing with
LUA parsing and extraction of the LUA data.</p>
<p>The usage would be to create an instance of TSConfig, passing it a configuration file and a set of
“roots”. The configuration file would be loaded and interpreted as a LUA file. After that a set of
global variables, identified by the roots passed in, would be copied in to the C++ container. The
roots could each contain a tree of arbitrary depth, the group forming a forest. This forest could
then be walked or examined in way very similar to how the current configuration data is accessed,
but with more generality.</p>
<ul class="simple">
<li>Relative paths could be used rather than absolute paths.</li>
<li>Run time type checking of values.</li>
</ul>
</div>
<div class="section" id="implementation">
<h2>Implementation<a class="headerlink" href="#implementation" title="Permalink to this headline">¶</a></h2>
<p>TSConfig needs to be able to extract trees of arbitrary depth from LUA. Some work has been done with
this but there is not yet a full implementation.</p>
<p>On the TSConfig side, the library is currently working and should be relatively easy to adapt to LUA
because this will be mostly removing parsing code. A side effect of this will be to finally put an
end to the FLEX/Bison issues where these files get updated inappropriately causing source control
issues.</p>
</div>
<div class="section" id="interface">
<h2>Interface<a class="headerlink" href="#interface" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="_CPPv28TSConfig">
<span id="TSConfig"></span><em class="property">class </em><code class="descclassname"></code><code class="descname">TSConfig</code><a class="headerlink" href="#_CPPv28TSConfig" title="Permalink to this definition">¶</a><br /></dt>
<dd><dl class="function">
<dt id="_CPPv2N8TSConfig8TSConfigEv">
<span id="TSConfig::TSConfig"></span><code class="descclassname"></code><code class="descname">TSConfig</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv2N8TSConfig8TSConfigEv" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Default constructor, creates an empty configuration.</p>
</dd></dl>

<dl class="function">
<dt id="_CPPv2N8TSConfig8add_rootE11string_view">
<span id="TSConfig::add_root__string_view"></span><a class="reference internal" href="#_CPPv28TSConfig" title="TSConfig">TSConfig</a> &amp;<code class="descclassname"></code><code class="descname">add_root</code><span class="sig-paren">(</span><a class="reference internal" href="external-types.en.html#_CPPv211string_view" title="string_view">string_view</a> <em>name</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv2N8TSConfig8add_rootE11string_view" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Add a root. This will become available as a name in the root map of the configuration and the
value of the global variable of the same name in the LUA state will be copied to that name.</p>
</dd></dl>

<dl class="function">
<dt id="_CPPv2N8TSConfig4loadE11string_view">
<span id="TSConfig::load__string_view"></span>bool <code class="descclassname"></code><code class="descname">load</code><span class="sig-paren">(</span><a class="reference internal" href="external-types.en.html#_CPPv211string_view" title="string_view">string_view</a> <em>path</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv2N8TSConfig4loadE11string_view" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Load a configuration file. The file will be loaded and then interpreted as a LUA script. The
set of global variables defined by the roots of the configuration will have their values
copied from the LUA state to the corresponding names in the root table.</p>
</dd></dl>

<dl class="function">
<dt id="_CPPv2N8TSConfig4rootEv">
<span id="TSConfig::root"></span><a class="reference internal" href="#_CPPv213TSConfigValue" title="TSConfigValue">TSConfigValue</a> <code class="descclassname"></code><code class="descname">root</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv2N8TSConfig4rootEv" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Return the root value of the configuration. This will be a <code class="code docutils literal"><span class="pre">table</span></code>. The keys for the
table will be the roots added to the configuration via <a class="reference internal" href="#_CPPv2N8TSConfig8add_rootE11string_view" title="TSConfig::add_root"><code class="xref cpp cpp-func docutils literal"><span class="pre">TSConfig::add_root()</span></code></a>. The values
for the keys will be the values of the corresponding global variables in the LUA state.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="_CPPv213TSConfigValue">
<span id="TSConfigValue"></span><em class="property">class </em><code class="descclassname"></code><code class="descname">TSConfigValue</code><a class="headerlink" href="#_CPPv213TSConfigValue" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Configuration data in a <a class="reference internal" href="#_CPPv28TSConfig" title="TSConfig"><code class="xref cpp cpp-class docutils literal"><span class="pre">TSConfig</span></code></a> instance. This is a generic type that covers all of the
possible types in a configuration. A value is either a <em>primitive</em> which is a single basic value
or a <em>table</em> which is a container for other values. A <code class="code docutils literal"><span class="pre">table</span></code> can have indexed values and also
named values, to be similar to a LUA table.</p>
<dl class="docutils">
<dt>Primitives</dt>
<dd><dl class="first last docutils">
<dt><code class="code docutils literal"><span class="pre">nil</span></code></dt>
<dd>No value.</dd>
<dt><code class="code docutils literal"><span class="pre">integer</span></code></dt>
<dd>A signed integer.</dd>
<dt><code class="code docutils literal"><span class="pre">string</span></code></dt>
<dd>A string (sequence of characters).</dd>
<dt><code class="code docutils literal"><span class="pre">float</span></code></dt>
<dd>A floating point number.</dd>
<dt><code class="code docutils literal"><span class="pre">ip</span></code></dt>
<dd>An IP address.</dd>
</dl>
</dd>
</dl>
<dl class="function">
<dt id="_CPPv2N13TSConfigValue13TSConfigValueEv">
<span id="TSConfigValue::TSConfigValue"></span><code class="descclassname"></code><code class="descname">TSConfigValue</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv2N13TSConfigValue13TSConfigValueEv" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Default constructor, creates a <code class="code docutils literal"><span class="pre">nil</span></code> value.</p>
</dd></dl>

<dl class="function">
<dt id="_CPPv2NK13TSConfigValue12is_primitiveEv">
<span id="TSConfigValue::is_primitiveC"></span>bool <code class="descclassname"></code><code class="descname">is_primitive</code><span class="sig-paren">(</span><span class="sig-paren">)</span> <em class="property">const</em><a class="headerlink" href="#_CPPv2NK13TSConfigValue12is_primitiveEv" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Returns <code class="code docutils literal"><span class="pre">true</span></code> if this is a <code class="code docutils literal"><span class="pre">primitive</span></code>, <code class="code docutils literal"><span class="pre">false</span></code> otherwise.</p>
</dd></dl>

<dl class="function">
<dt id="_CPPv2NK13TSConfigValue8is_tableEv">
<span id="TSConfigValue::is_tableC"></span>bool <code class="descclassname"></code><code class="descname">is_table</code><span class="sig-paren">(</span><span class="sig-paren">)</span> <em class="property">const</em><a class="headerlink" href="#_CPPv2NK13TSConfigValue8is_tableEv" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Returns <code class="code docutils literal"><span class="pre">true</span></code> if this is a <code class="code docutils literal"><span class="pre">table</span></code>, <code class="code docutils literal"><span class="pre">false</span></code> otherwise.</p>
</dd></dl>

<dl class="function">
<dt id="_CPPv2N13TSConfigValueixEi">
<span id="TSConfigValue::subscript-operator__i"></span><a class="reference internal" href="#_CPPv213TSConfigValue" title="TSConfigValue">TSConfigValue</a> <code class="descclassname"></code><code class="descname">operator[]</code><span class="sig-paren">(</span>int <em>idx</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv2N13TSConfigValueixEi" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Get the value at <em>idx</em>. If this is not a <code class="code docutils literal"><span class="pre">table</span></code> or there is no value at <em>idx</em>
a <code class="code docutils literal"><span class="pre">nil</span></code> value is returned.</p>
</dd></dl>

<dl class="function">
<dt id="_CPPv2N13TSConfigValueixE11string_view">
<span id="TSConfigValue::subscript-operator__string_view"></span><a class="reference internal" href="#_CPPv213TSConfigValue" title="TSConfigValue">TSConfigValue</a> <code class="descclassname"></code><code class="descname">operator[]</code><span class="sig-paren">(</span><a class="reference internal" href="external-types.en.html#_CPPv211string_view" title="string_view">string_view</a> <em>name</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv2N13TSConfigValueixE11string_view" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Get the value for the key <em>name</em>. If this is not a <code class="code docutils literal"><span class="pre">table</span></code> or there the key
<em>name</em> is not in the table, a <code class="code docutils literal"><span class="pre">nil</span></code> value is returned.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="future-work">
<h2>Future Work<a class="headerlink" href="#future-work" title="Permalink to this headline">¶</a></h2>
<p>It would be beneficial if configuration could be grouped by specific applications / properties /
customers instead of by subsystem.</p>
</div>
<div class="section" id="schema">
<h2>Schema<a class="headerlink" href="#schema" title="Permalink to this headline">¶</a></h2>
<p>Configuration data should be schema based. Use Lua for syntax and take structure from JSON schema. The schema is used to generate a C++ structure that contains schema data along with storage for configuration data. Code is written to look up data in the configuration structure and populate a C++ domain specific structure.</p>
<p>For SNI configuration, this is a mapping of FQDNs to actions and properties. To support this we will
need type references / definitions and enumerations.</p>
<p>The schema will be used to build a C++ structure that models the schema and contains storage for data extracted from the configuration file. Loading will take a path and an instance of the configuration structure. Any data from the schema that is needed must be embedded in the configuration structure.</p>
<p>Example use:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="n">SNIConfig</span> <span class="n">tls_conf</span><span class="p">;</span> <span class="c1">// Schema &amp; output structure. Name derived from schema data.</span>
<span class="n">ts</span><span class="o">::</span><span class="n">Errata</span> <span class="n">r</span> <span class="o">=</span> <span class="n">tls_conf</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">path</span><span class="p">);</span> <span class="c1">// path to file</span>
</pre></div>
</div>
<p>Example schema for SNI configuration.</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="p">{</span>
   <span class="s2">&quot;$scheme&quot;</span><span class="p">:</span> <span class="s2">&quot;URI&quot;</span><span class="p">,</span>
   <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;TLS&quot;</span><span class="p">,</span>
   <span class="n">cname</span><span class="p">:</span> <span class="s2">&quot;SNIConfig&quot;</span><span class="p">,</span>
   <span class="n">global</span><span class="p">:</span> <span class="s2">&quot;sni_config&quot;</span><span class="p">,</span>
   <span class="nb">type</span><span class="p">:</span> <span class="s2">&quot;array&quot;</span><span class="p">,</span>
   <span class="n">items</span><span class="p">:</span> <span class="p">{</span>
      <span class="nb">type</span><span class="p">:</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span>
      <span class="n">properties</span><span class="p">:</span> <span class="p">{</span>
         <span class="n">fqdn</span><span class="p">:</span> <span class="p">{</span>
            <span class="nb">type</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
            <span class="n">validators</span><span class="p">:</span> <span class="p">{</span> <span class="n">fqdn</span><span class="o">-</span><span class="n">check</span> <span class="p">}</span>
            <span class="p">)</span>
         <span class="p">}</span>
      <span class="p">}</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Example configuration file:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="n">sni_config</span> <span class="o">=</span> <span class="p">{</span>
   <span class="p">{</span> <span class="nl">fqdn</span><span class="p">:</span><span class="s">&quot;one.com&quot;</span><span class="p">,</span> <span class="nl">action</span><span class="p">:</span><span class="n">TLS</span><span class="p">.</span><span class="n">ACTION</span><span class="p">.</span><span class="n">TUNNEL</span><span class="p">,</span> <span class="nl">upstream_cert_verification</span><span class="p">:</span><span class="n">TLS</span><span class="p">.</span><span class="n">VERIFY</span><span class="p">.</span><span class="n">REQUIRED</span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Example C++ data structure:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TsConfigDescriptor</span> <span class="p">{</span>
   <span class="k">enum</span> <span class="k">class</span> <span class="nc">Type</span> <span class="p">{</span> <span class="n">ARRAY</span><span class="p">,</span> <span class="n">OBJECT</span><span class="p">,</span> <span class="n">INT</span><span class="p">,</span> <span class="n">FLOAT</span><span class="p">,</span> <span class="n">STRING</span><span class="p">,</span> <span class="n">ENUM</span> <span class="p">};</span>
   <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">name</span><span class="p">;</span>
   <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">description</span><span class="p">;</span>
   <span class="n">Type</span> <span class="n">type</span><span class="p">;</span>
   <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">type_name</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">TsConfigEnumDescriptor</span> <span class="o">:</span> <span class="k">public</span> <span class="n">TsConfigBaseDescriptor</span> <span class="p">{</span>
   <span class="n">std</span><span class="o">::</span><span class="n">unordered_map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="n">values</span><span class="p">;</span>
   <span class="n">std</span><span class="o">::</span><span class="n">unordered_map</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">keys</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">TsConfigObjectDescriptor</span> <span class="o">:</span> <span class="k">public</span> <span class="n">TsConfigBaseDescriptor</span> <span class="p">{</span>
   <span class="n">std</span><span class="o">::</span><span class="n">unordered_map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span> <span class="n">TsConfigBaseDescriptor</span> <span class="k">const</span><span class="o">*&gt;</span> <span class="n">fields</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">TsConfigArrayDescriptor</span> <span class="o">:</span> <span class="k">public</span> <span class="n">TsConfigBaseDescriptor</span> <span class="p">{</span>
   <span class="n">TsConfigArrayDescriptor</span><span class="p">(</span><span class="n">TsConfigBaseDescriptor</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">d</span><span class="p">)</span> <span class="o">:</span> <span class="n">item</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="p">{}</span>
   <span class="n">TsConfigBaseDescriptor</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">item</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Base class of config structures for generic access.</span>

<span class="cm">   Each config class has a static member of type @c TsConfigDesciptor or a subclass.</span>
<span class="cm">   A reference to that member is passed to this base class in the constructor. Then</span>
<span class="cm">   access is available generically by casting the config structure to this class.</span>

<span class="cm">   @note The reference mechanism is needed so that each config struct can have its own</span>
<span class="cm">   instance with static values. If inherited there would be only one for all subclasses.</span>
<span class="cm">*/</span>
<span class="k">class</span> <span class="nc">TsConfigBase</span> <span class="p">{</span>
   <span class="n">TsConfigBase</span><span class="p">(</span><span class="n">TsConfigDescriptor</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">d</span><span class="p">)</span> <span class="o">:</span> <span class="n">descriptor</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="p">{}</span>
   <span class="n">TsConfigDescriptor</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">descriptor</span><span class="p">;</span>

   <span class="k">virtual</span> <span class="n">ts</span><span class="o">::</span><span class="n">Errata</span> <span class="n">loader</span><span class="p">(</span><span class="n">lua_State</span><span class="o">*</span> <span class="n">s</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">template</span> <span class="o">&lt;</span> <span class="k">typename</span> <span class="n">T</span> <span class="o">&gt;</span>
<span class="k">class</span> <span class="nc">TsConfigInt</span> <span class="o">:</span> <span class="k">public</span> <span class="n">TsConfigBase</span> <span class="p">{</span>
   <span class="n">TsConfigInt</span><span class="p">(</span><span class="n">TsConfigDesciptor</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">d</span><span class="p">,</span> <span class="p">(</span><span class="n">T</span><span class="o">::</span><span class="kt">int</span><span class="p">)</span><span class="o">&amp;</span> <span class="n">i</span><span class="p">)</span> <span class="o">:</span> <span class="n">TsConfigBase</span><span class="p">(</span><span class="n">d</span><span class="p">),</span> <span class="n">ref</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">{}</span>
   <span class="n">T</span><span class="o">::</span><span class="kt">int</span> <span class="o">&amp;</span> <span class="n">ref</span><span class="p">;</span>
   <span class="n">ts</span><span class="o">::</span><span class="n">Errata</span> <span class="n">loader</span><span class="p">(</span><span class="n">lua_State</span><span class="o">*</span> <span class="n">s</span><span class="p">)</span> <span class="k">override</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">template</span> <span class="o">&lt;</span> <span class="k">typename</span> <span class="n">T</span><span class="p">,</span> <span class="k">typename</span> <span class="n">E</span> <span class="o">&gt;</span>
<span class="k">class</span> <span class="nc">TsConfigEnum</span> <span class="o">:</span> <span class="k">public</span> <span class="n">TsConfigBase</span> <span class="p">{</span>
   <span class="n">TsConfigInt</span><span class="p">(</span><span class="n">TsConfigDesciptor</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">d</span><span class="p">,</span> <span class="p">(</span><span class="n">T</span><span class="o">::</span><span class="n">E</span><span class="p">)</span><span class="o">&amp;</span> <span class="n">i</span><span class="p">)</span> <span class="o">:</span> <span class="n">TsConfigBase</span><span class="p">(</span><span class="n">d</span><span class="p">),</span> <span class="n">ref</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">{}</span>
   <span class="n">T</span><span class="o">::</span><span class="n">E</span> <span class="o">&amp;</span> <span class="n">ref</span><span class="p">;</span>
   <span class="n">ts</span><span class="o">::</span><span class="n">Errata</span> <span class="n">loader</span><span class="p">(</span><span class="n">lua_State</span><span class="o">*</span> <span class="n">s</span><span class="p">)</span> <span class="k">override</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">struct</span> <span class="nl">LuaSNIConfig</span> <span class="p">:</span> <span class="k">public</span> <span class="n">TsConfigBase</span> <span class="p">{</span>
   <span class="k">using</span> <span class="n">self</span> <span class="o">=</span> <span class="n">LuaSNIConfig</span><span class="p">;</span>
   <span class="k">enum</span> <span class="k">class</span> <span class="nc">Action</span> <span class="p">{</span> <span class="n">CLOSE</span><span class="p">,</span> <span class="n">TUNNEL</span> <span class="p">};</span>

   <span class="k">static</span> <span class="n">TsConfigArrayDescriptor</span> <span class="n">DESCRIPTOR</span><span class="p">;</span>
   <span class="n">LuaSNIConfig</span><span class="p">()</span> <span class="o">:</span> <span class="n">TsConfigBase</span><span class="p">(</span><span class="n">DESCRIPTOR</span><span class="p">),</span> <span class="n">DESCRIPTOR</span><span class="p">(</span><span class="n">Item</span><span class="o">::</span><span class="n">DESCRIPTOR</span><span class="p">)</span> <span class="p">{}</span>

   <span class="k">struct</span> <span class="nl">Item</span> <span class="p">:</span> <span class="k">public</span> <span class="n">TsConfigBase</span> <span class="p">{</span>
      <span class="n">Item</span><span class="p">()</span> <span class="o">:</span> <span class="n">TsConfigBase</span><span class="p">(</span><span class="n">DESCRIPTOR</span><span class="p">),</span>
         <span class="n">FQDN_CONFIG</span><span class="p">(</span><span class="n">FQDN_DESCRIPTOR</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">self</span><span class="o">::</span><span class="n">fqdn</span><span class="p">),</span>
         <span class="n">LEVEL_CONFIG</span><span class="p">(</span><span class="n">LEVEL_DESCRIPTOR</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">self</span><span class="o">::</span><span class="n">level</span><span class="p">),</span>
         <span class="n">ACTION_CONFIG</span><span class="p">(</span><span class="n">ACTION_DESCRIPTOR</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">self</span><span class="o">::</span><span class="n">action</span><span class="p">)</span>
         <span class="p">{</span> <span class="p">}</span>
      <span class="n">Errata</span> <span class="n">loader</span><span class="p">(</span><span class="n">lua_State</span><span class="o">*</span> <span class="n">s</span><span class="p">)</span> <span class="k">override</span><span class="p">;</span>

      <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">fqdn</span><span class="p">;</span>
      <span class="kt">int</span> <span class="n">level</span><span class="p">;</span>
      <span class="n">Action</span> <span class="n">action</span><span class="p">;</span>

      <span class="c1">// These need to be initialized statically.</span>
      <span class="k">static</span> <span class="n">TsConfigObjectDescriptor</span> <span class="n">DESCRIPTOR</span><span class="p">;</span>
      <span class="k">static</span> <span class="n">TsConfigBaseDescriptor</span> <span class="n">FQDN_DESCRIPTOR</span><span class="p">;</span>
      <span class="k">static</span> <span class="n">TsConfigString</span><span class="o">&lt;</span><span class="n">Item</span><span class="o">&gt;</span> <span class="n">FQDN_CONFIG</span><span class="p">;</span>
      <span class="k">static</span> <span class="n">TsConfigBaseDescriptor</span> <span class="n">LEVEL_DESCRIPTOR</span><span class="p">;</span>
      <span class="k">static</span> <span class="n">TsConfigInt</span><span class="o">&lt;</span><span class="n">Item</span><span class="o">&gt;</span> <span class="n">LEVEL_CONFIG</span><span class="p">;</span>
      <span class="k">static</span> <span class="n">TsConfigEnumDescriptor</span> <span class="n">ACTION_DESCRIPTOR</span><span class="p">;</span>
      <span class="k">static</span> <span class="n">TsConfigEnum</span><span class="o">&lt;</span><span class="n">Item</span><span class="p">,</span> <span class="n">ACTION</span><span class="o">&gt;</span> <span class="n">ACTION_CONFIG</span><span class="p">;</span>
   <span class="p">};</span>
   <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Item</span><span class="o">&gt;</span> <span class="n">items</span><span class="p">;</span>
   <span class="n">ts</span><span class="o">::</span><span class="n">Errata</span> <span class="n">loader</span><span class="p">(</span><span class="n">lua_State</span><span class="o">*</span> <span class="n">s</span><span class="p">)</span> <span class="k">override</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="cache-tool.en.html" title="Cache Tool"
             >next</a> |</li>
        <li class="right" >
          <a href="buffer-writer.en.html" title="Buffer Writer"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">SWOC Docs</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="ats-projects.en.html" >Traffic Server Projects</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, amc@apache.org.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.3.
    </div>
  </body>
</html>